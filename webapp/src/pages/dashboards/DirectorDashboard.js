import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/**
 * Director Dashboard (Part of the "Director OS")
 * ============================================
 * High-level strategic overview for School Directors/Owners.
 * Consumes the "Digital CEO" agent API (api/routes/director.py).
 * Prioritizes high-level financial & academic health metrics.
 */
import { useQuery } from "@tanstack/react-query";
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, AreaChart, Area } from "recharts";
import { Users, DollarSign, AlertTriangle, Activity, Layout, Upload, ShieldCheck, Brain, CreditCard } from "lucide-react";
import { motion } from "framer-motion";
import clsx from "clsx";
import { apiClient } from "../../lib/apiClient";
import { useBrandingStore } from "../../stores/branding";
const KPICard = ({ title, value, status, icon: Icon, subtext }) => (_jsxs("div", { className: "bg-slate-900 border border-slate-800 rounded-2xl p-6 hover:border-slate-700 transition-colors", children: [_jsxs("div", { className: "flex justify-between items-start mb-4", children: [_jsxs("div", { children: [_jsx("p", { className: "text-slate-400 text-sm font-medium uppercase tracking-wide", children: title }), _jsx("h3", { className: "text-3xl font-bold text-white mt-2", children: value })] }), _jsx("div", { className: clsx("p-3 rounded-xl", status === 'good' ? "bg-emerald-500/10 text-emerald-500" :
                        status === 'warning' ? "bg-amber-500/10 text-amber-500" :
                            "bg-red-500/10 text-red-500"), children: _jsx(Icon, { size: 24 }) })] }), subtext && (_jsx("div", { className: "flex items-center gap-2", children: _jsx("span", { className: clsx("text-sm font-medium", status === 'good' ? "text-emerald-500" :
                    status === 'warning' ? "text-amber-500" : "text-red-500"), children: subtext }) }))] }));
export const DirectorDashboard = () => {
    const schoolId = useBrandingStore((state) => state.schoolId) || "demo-school";
    // 1. Fetch One-Minute Overview (Digital CEO Logic)
    const { data: overviewData, isLoading: isLoadingOverview } = useQuery({
        queryKey: ["director-overview", schoolId],
        queryFn: async () => {
            const res = await apiClient.get(`/${schoolId}/director/overview`);
            return res.data.data;
        },
        enabled: Boolean(schoolId),
    });
    // 2. Fetch Trends for Charts
    const { data: trendsData } = useQuery({
        queryKey: ["director-trends", schoolId],
        queryFn: async () => {
            const res = await apiClient.get(`/${schoolId}/director/trends`);
            return res.data.trends || [];
        },
        enabled: Boolean(schoolId),
    });
    const isHealthy = overviewData?.health_score && overviewData.health_score > 80;
    return (_jsxs("div", { className: "p-4 md:p-8 max-w-7xl mx-auto space-y-8 pb-20", children: [overviewData?.strategic_insight && (_jsxs(motion.div, { initial: { opacity: 0, y: -20 }, animate: { opacity: 1, y: 0 }, className: "bg-indigo-600/10 border border-indigo-500/30 rounded-2xl p-6 flex gap-4 items-center shadow-lg shadow-indigo-500/5", children: [_jsx("div", { className: "bg-indigo-600 p-3 rounded-xl shadow-lg shadow-indigo-500/20", children: _jsx(Brain, { size: 24, className: "text-white" }) }), _jsxs("div", { children: [_jsxs("h3", { className: "text-indigo-300 text-xs font-bold uppercase tracking-widest mb-1 flex items-center gap-2", children: ["Digital CEO Perspective", _jsx("span", { className: "w-1.5 h-1.5 rounded-full bg-indigo-400 animate-pulse" })] }), _jsxs("p", { className: "text-white font-medium italic leading-relaxed", children: ["\"", overviewData.strategic_insight, "\""] })] })] })), _jsxs("div", { className: "flex flex-col md:flex-row justify-between items-start md:items-center gap-4", children: [_jsxs("div", { children: [_jsx("h1", { className: "text-2xl font-bold text-white", children: "Director's Suite" }), _jsxs("p", { className: "text-slate-400 mt-1", children: ["Strategic oversight for ", schoolId.replace(/-/g, ' ')] })] }), _jsx("div", { className: "flex items-center gap-3", children: _jsxs("div", { className: clsx("px-4 py-1.5 rounded-full text-sm font-medium border flex items-center gap-2", isHealthy
                                ? "bg-emerald-500/10 text-emerald-500 border-emerald-500/20"
                                : "bg-amber-500/10 text-amber-500 border-amber-500/20"), children: [_jsx(ShieldCheck, { size: 16 }), isHealthy ? "System Healthy" : "Attention Needed"] }) })] }), _jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-4", children: [_jsxs("button", { onClick: () => window.location.href = '/tools/template-builder', className: "bg-indigo-600/10 hover:bg-indigo-600/20 border border-indigo-500/30 text-indigo-300 p-4 rounded-2xl flex flex-col items-center justify-center gap-2 transition-all", children: [_jsx(Layout, { size: 24, className: "mb-1" }), _jsx("span", { className: "text-sm font-semibold", children: "Report Builder" })] }), _jsxs("button", { onClick: () => window.location.href = '/tools/import', className: "bg-emerald-600/10 hover:bg-emerald-600/20 border border-emerald-500/30 text-emerald-300 p-4 rounded-2xl flex flex-col items-center justify-center gap-2 transition-all", children: [_jsx(Upload, { size: 24, className: "mb-1" }), _jsx("span", { className: "text-sm font-semibold", children: "Universal Import" })] }), _jsxs("button", { onClick: () => window.location.href = '/tools/document-hub', className: "bg-blue-600/10 hover:bg-blue-600/20 border border-blue-500/30 text-blue-300 p-4 rounded-2xl flex flex-col items-center justify-center gap-2 transition-all", children: [_jsx(CreditCard, { size: 24, className: "mb-1" }), _jsx("span", { className: "text-sm font-semibold", children: "Document Hub" })] }), _jsxs("button", { className: "bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-300 p-4 rounded-2xl flex flex-col items-center justify-center gap-2 transition-all", children: [_jsx(Activity, { size: 24, className: "mb-1" }), _jsx("span", { className: "text-sm font-semibold", children: "Audit Logs" })] })] }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-6", children: [_jsx(KPICard, { title: "Fee Collection", value: `${overviewData?.finance?.collection_rate || 0}%`, status: (overviewData?.finance?.collection_rate || 0) > 80 ? 'good' :
                            (overviewData?.finance?.collection_rate || 0) > 50 ? 'warning' : 'alert', icon: DollarSign, subtext: isLoadingOverview ? "Calculating..." : "Target: 90%" }), _jsx(KPICard, { title: "Attendance", value: `${overviewData?.academics?.attendance_rate || 0}%`, status: (overviewData?.academics?.attendance_rate || 0) > 90 ? 'good' : 'warning', icon: Users, subtext: "Daily Average" }), _jsx(KPICard, { title: "Academic Health", value: overviewData?.academics?.average_grade || "-", status: overviewData?.academics?.status === "healthy" ? "good" : "warning", icon: Activity, subtext: "School Wide GPA" })] }), _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-2 gap-6", children: [_jsxs("div", { className: "bg-slate-900 border border-slate-800 rounded-2xl p-6", children: [_jsx("h3", { className: "text-lg font-semibold text-white mb-6", children: "Revenue Trajectory (6 Months)" }), _jsx("div", { className: "h-[300px] w-full", children: trendsData?.length > 0 ? (_jsx(ResponsiveContainer, { width: "100%", height: "100%", children: _jsxs(AreaChart, { data: trendsData, children: [_jsx("defs", { children: _jsxs("linearGradient", { id: "colorFees", x1: "0", y1: "0", x2: "0", y2: "1", children: [_jsx("stop", { offset: "5%", stopColor: "#10B981", stopOpacity: 0.3 }), _jsx("stop", { offset: "95%", stopColor: "#10B981", stopOpacity: 0 })] }) }), _jsx(CartesianGrid, { strokeDasharray: "3 3", stroke: "#1e293b", vertical: false }), _jsx(XAxis, { dataKey: "name", stroke: "#64748b", axisLine: false, tickLine: false }), _jsx(YAxis, { stroke: "#64748b", axisLine: false, tickLine: false }), _jsx(Tooltip, { contentStyle: { backgroundColor: '#0f172a', border: '1px solid #1e293b', borderRadius: '8px' } }), _jsx(Area, { type: "monotone", dataKey: "fees", stroke: "#10B981", strokeWidth: 3, fillOpacity: 1, fill: "url(#colorFees)" })] }) })) : (_jsx("div", { className: "h-full flex items-center justify-center text-slate-500", children: "Not enough data for trends yet." })) })] }), _jsxs("div", { className: "bg-slate-900 border border-slate-800 rounded-2xl p-6", children: [_jsx("h3", { className: "text-lg font-semibold text-white mb-6", children: "Attendance Overview" }), _jsx("div", { className: "h-[300px] w-full", children: trendsData?.length > 0 ? (_jsx(ResponsiveContainer, { width: "100%", height: "100%", children: _jsxs(BarChart, { data: trendsData, children: [_jsx(CartesianGrid, { strokeDasharray: "3 3", stroke: "#1e293b", vertical: false }), _jsx(XAxis, { dataKey: "name", stroke: "#64748b", axisLine: false, tickLine: false }), _jsx(YAxis, { stroke: "#64748b", axisLine: false, tickLine: false }), _jsx(Tooltip, { cursor: { fill: '#1e293b' }, contentStyle: { backgroundColor: '#0f172a', border: '1px solid #1e293b', borderRadius: '8px' } }), _jsx(Bar, { dataKey: "attendance", fill: "#3B82F6", radius: [4, 4, 0, 0], barSize: 40 })] }) })) : (_jsx("div", { className: "h-full flex items-center justify-center text-slate-500", children: "Waiting for attendance data..." })) })] })] }), (!overviewData?.finance?.status || overviewData.finance.status === "distressed") && (_jsxs("div", { className: "bg-red-500/5 border border-red-500/20 rounded-2xl p-6 animate-in fade-in slide-in-from-bottom-5", children: [_jsxs("h3", { className: "text-lg font-semibold text-red-500 flex items-center gap-2 mb-4", children: [_jsx(AlertTriangle, { size: 20 }), "Critical Attention Needed"] }), _jsx("div", { className: "space-y-4", children: _jsxs("div", { className: "flex items-start gap-4 p-4 bg-red-500/10 rounded-xl border border-red-500/10", children: [_jsx("div", { className: "w-2 h-2 mt-2 rounded-full bg-red-500" }), _jsxs("div", { children: [_jsx("h4", { className: "text-white font-medium", children: "Financial Health Check" }), _jsxs("p", { className: "text-slate-400 text-sm mt-1", children: ["Fee collection is below target (", overviewData?.finance?.collection_rate || 0, "%). Consider running a bulk SMS reminder campaign via the Admin Dashboard."] })] })] }) })] }))] }));
};
